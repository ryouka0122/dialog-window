<html lang="ja">
<head>
    <title>*Parent* Popup Window Sample</title>
    <meta charset="utf-8">
    <script src="PopupDialog.js"></script>
    <script>

      const agent = new PopupDialogAgent(window);

      function onload() {
        if (!window.opener) {
          // 直接開いたときの処理
          alert("直接開かないでください");
          return;
        }

        // ウィンドウ閉じたときの処理
        window.addEventListener("beforeunload", () => {
          // 親ウィンドウにメッセージ送信
          agent.sendMessage("close");
        });

        // 親ウィンドウからのメッセージ受信処理の設定
        agent.addMessageListener("data", (event) => {
          document.getElementById("message").innerText = event.data.message;
        });

        // 初期データ取得メッセージ送信（疑似）
        agent.sendMessage("initialized");
      }

      // 親ウィンドウに入力内容を送信
      function sendToParent() {
        const text = document.getElementById("childText").value
        agent.sendMessage("result", {
          "message": "[Child2] " + text
        });
      }
    </script>
</head>
<body onload="onload()">
<h1>Child2</h1>
<div>
    親ウィンドウから来たメッセージ
    <div id="message">
        aaaaaa
    </div>
</div>
<input type="text" id="childText"/>
<button onclick="sendToParent();">Callback Parent</button>
<br>
<br>
<button onclick="window.close();">close</button>
</body>
</html>
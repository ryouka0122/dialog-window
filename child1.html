<html lang="ja">
<head>
    <title>*Parent* Popup Window Sample</title>
    <meta charset="utf-8">
    <script src="PopupDialog.js"></script>
    <script>

      const agent = new PopupDialogAgent(window);

      function onload() {
        if (!window.opener) {
          // 直接開いたときの処理
          alert("直接開かないでください");
          return;
        }


        // ウィンドウ閉じたときの処理
        window.addEventListener("beforeunload", () => {
          // 親ウィンドウにメッセージ送信
          agent.sendMessage("close");
        });

        // 親ウィンドウから初期データを受け取るときの処理
        agent.addMessageListener("data", (event) => {
          document.getElementById("message").innerText = event.data.message;
        });

        // 初期データ取得メッセージを送信
        agent.sendMessage("initialized");
      }

      // 親ウィンドウに入力内容を送信（その後画面閉じる）
      function sendToParent() {
        const text = document.getElementById("childText").value
        agent.sendMessage("result", {
          "message": "[Child1] " + text
        });

        // ※※※※※※※※※※※※※※※※※※※※※※※※※※
        // ※ ここだけchild2.htmlと違う
        window.close();
      }

    </script>
</head>
<body onload="onload()">
<h1>Child1</h1>
<div>
    親ウィンドウから来たメッセージ
    <div id="message">
        aaaaaa
    </div>
</div>
<input type="text" id="childText"/>
<button onclick="sendToParent();">Callback Parent</button>
<br>
<br>
<button onclick="window.close();">close</button>
</body>
</html>
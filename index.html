<html lang="ja">
<head>
    <title>*Parent* Popup Window Sample</title>
    <meta charset="utf-8">
    <script src="PopupDialog.js"></script>
    <script>
      // 親ウィンドウの設定
      const dialogOwner = new PopupDialogOwner(window);

      function showDialog(url, popupName, {left, top, width, height, lockable}) {
        // 子ウィンドウ生成
        return dialogOwner.showDialog(
          url,
          popupName,
          {
            popup: "yes",
            toolbar: "no",
            menubar: "no",
            left,
            top,
            width,
            height,
            lockable
          }
        );
      }

      // ===================================================
      // モーダルダイアログの表示
      async function onShowModalDialog() {
        // 親ウィンドウは操作禁止用のレイヤーをオーバーレイ表示
        document.getElementById("cover").style.display = "block";

        // 子ウィンドウの生成
        const child1Window = showDialog("./child1.html", "child1", {
          left: 50,
          top: 100,
          width: 300,
          height: 300,
          lockable: true
        });

        // 初期化イベントを受信したときの処理
        child1Window.addMessageListener("initialized", () => {
          // メッセージイベントで子ウィンドウにデータを送信
          child1Window.sendMessage("data", {
            message: "Hello Child1 Window from Parent Window"
          })
        })
        child1Window.addMessageListener("close", () => {
          // 閉じただけの場合，
          // 非活性レイヤーの非表示
          document.getElementById("cover").style.display = "none";
        })

        // モーダルウィンドウの時は，特定のメッセージタイプを受信するまで待機できる
        const response = await child1Window.wait("result")

        // 子ウィンドウから届いたメッセージの設定
        document.getElementById("resultMessage").innerText = response.message;

        // 非活性レイヤーの非表示
        document.getElementById("cover").style.display = "none";
      }

      // ===================================================
      // モードレスダイアログの表示
      function onShowModelessDialog() {
        // 子ウィンドウの生成
        const child2Window = showDialog("./child2.html", "child2", {
          left: 100,
          top: 100,
          width: 500,
          height: 200
        });

        // 初期化イベントを受信したときの処理
        child2Window.addMessageListener("initialized", () => {
          // メッセージイベントで子ウィンドウにデータを送信
          child2Window.sendMessage("data", {
            message: "Hello Child2 Window from Parent Window"
          })
        })

        // モードレスウィンドウの時は特定のイベントを監視して，データを受け取るようにする
        child2Window.addMessageListener("result", (cw, ev) => {
          document.getElementById("resultMessage").innerText = ev.message;
        })

      }

      // ===================================================
      // 子ウィンドウからのメッセージ受信処理の設定
      function onload() {
        // 親ダイアログとして，メッセージイベントを受け取れるようにする
        dialogOwner.start()
      }

    </script>
    <style>
        .gray-cover {
            position: fixed; /* ブラウザの定位置に固定 */
            background: rgba(0, 0, 0, .5); /* 背景色を半透明の黒色に */
            width: 100%; /* 要素の横幅を画面全体に */
            height: 100%; /* 要素の高さを画面全体に */
            top: 0; /* 要素の固定位置をブラウザ最上部に合わせる */
            left: 0; /* 要素の固定位置をブラウザ左側に合わせる */
            z-index: 1000; /* 要素をコンテンツより前面に（要調整） */
        }
    </style>
</head>
<body onload="onload();">
<h3>ダイアログ</h3>
<button onclick="onShowModalDialog()">モーダルダイアログ表示</button>
<br>
<br>
<button onclick="onShowModelessDialog()">モードレスダイアログ表示</button>
<div>
    <h3>
        ダイアログから帰ってきたメッセージ
    </h3>
    <div id="resultMessage" style="border:1px solid black;">
        ああああああ
    </div>
</div>
<div id="cover" class="gray-cover" style="display: none;"></div>
</body>
</html>